<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PT-RQ35K é¸å–®å°è¦½</title>
    <style>
        :root { 
            --navy-dark: #050505; --card-bg: #1a1a1a; --gold: #d4af37; 
            --text-main: #ffffff; --text-sub: #d1d1d1; --active-blue: #007aff; --sop-green: #28cd41; --danger: #ff3b30;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        html, body { 
            background: var(--navy-dark); margin: 0; padding: 0; 
            color: var(--text-main); font-family: "Inter", "PingFang TC", "Microsoft JhengHei", sans-serif; 
            height: 100vh; height: 100svh; overflow: hidden; 
        }

        .main-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; }
        header { 
            background: #000; color: var(--gold); padding: 12px 15px; border-bottom: 2px solid var(--gold); 
            flex-shrink: 0; display: flex; justify-content: space-between; align-items: center;
        }
        .header-title { font-weight: 900; letter-spacing: 2px; font-size: 14px; }
        .header-team { font-weight: 400; font-size: 10px; opacity: 0.8; letter-spacing: 1px; }
        
        .top-fixed-area { background: #111; border-bottom: 1px solid #222; flex-shrink: 0; z-index: 1000; }
        .search-container { padding: 12px 15px 8px 15px; position: relative; display: flex; align-items: center; }
        #searchInput { width: 100%; padding: 14px 45px 14px 14px; border-radius: 10px; border: 1px solid #444; background: #222; color: white; font-size: 16px; outline: none; transition: 0.3s; }
        .clear-btn { position: absolute; right: 25px; width: 24px; height: 24px; background: #444; color: #fff; border-radius: 50%; border: none; cursor: pointer; display: none; align-items: center; justify-content: center; font-size: 14px; font-weight: bold; }
        .clear-btn.active { display: flex; }

        .tab-group { display: flex; gap: 5px; padding: 0 15px 12px 15px; }
        .tab-btn { flex: 1; padding: 10px 5px; border-radius: 8px; border: 1px solid #333; background: #1a1a1a; color: #888; cursor: pointer; font-weight: bold; font-size: 14px; }
        .tab-btn.active { background: var(--active-blue); color: white; border-color: var(--active-blue); }
        .tab-btn.gold.active { background: var(--gold); color: black; border-color: var(--gold); }
        .tab-btn.red.active { background: var(--danger); color: white; border-color: var(--danger); }

        .content-container { flex: 1; overflow-y: auto; padding: 12px 12px 100px 12px; scroll-behavior: smooth; }
        .view-section { display: none; width: 100%; }
        .view-section.active { display: block; }

        .node { margin-bottom: 8px; width: 100%; }
        .node.hidden { display: none; }
        .label { cursor: pointer; padding: 15px 12px 15px 42px; border-radius: 12px; background: var(--card-bg); border: 1px solid #2a2a2a; display: flex; align-items: center; position: relative; }
        .label::before { content: 'â–¶'; font-size: 9px; position: absolute; left: 18px; color: var(--gold); transition: 0.2s; }
        .node.expanded > .label::before { transform: rotate(90deg); }
        .node.leaf > .label::before { content: 'â—‹'; color: #666; }
        
        .cn-text { font-weight: 900; font-size: 16px; color: #fff; margin-right: 8px; }
        .en-text { font-weight: 300; font-size: 13px; color: var(--gold); opacity: 0.8; } 
        
        .options-box { margin: 8px 0 8px 30px; background: #000; border: 1px dashed #444; border-radius: 10px; padding: 12px; display: none; }
        .node.expanded > .options-box { display: block; }
        .option-item { color: #aaa; font-size: 14px; margin-bottom: 4px; display: flex; align-items: center; }
        .option-item::before { content: 'â€¢'; color: var(--gold); margin-right: 8px; }

        .children { margin-left: 18px; display: none; border-left: 2px solid #333; padding-left: 12px; margin-top: 8px; }
        .node.expanded > .children { display: block; }
        .highlight { background: #3d3400 !important; border: 1.5px solid var(--gold) !important; box-shadow: 0 0 15px rgba(212,175,55,0.3); }

        .card { background: #1a1a1a; padding: 18px; border-radius: 15px; margin-bottom: 12px; border-left: 6px solid var(--sop-green); line-height: 1.6; font-size: 15px; border-top: 1px solid #333; }
        .fault-card { border-left-color: var(--danger); background: #201516; }
        .step-tag { background: var(--sop-green); color: black; padding: 2px 8px; border-radius: 5px; margin-right: 10px; font-weight: 900; font-size: 11px; }
        .path-hint { color: var(--gold); font-size: 13px; display: block; margin-top: 8px; font-family: monospace; font-weight: bold; }
        h3 { color: var(--gold); border-bottom: 1px solid #333; padding-bottom: 10px; margin-top: 0; font-size: 19px; font-style: italic; }
        .fault-q { color: var(--danger); font-weight: 900; display: block; margin-bottom: 8px; font-size: 16px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <header>
        <span class="header-title">PT-RQ35K é¸å–®å°è¦½</span>
        <span class="header-team">TPAC AV TEAM</span>
    </header>

    <div class="top-fixed-area">
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="æœå°‹ï¼šæ­£æŠ•ã€4Kã€é‚„åŸã€ä»£ç¢¼..." oninput="globalSearch()">
            <button id="clearSearch" class="clear-btn" onclick="clearInput()">âœ•</button>
        </div>
        <div class="tab-group">
            <button id="btn-tree" class="tab-btn active" onclick="handleTreeTabClick()">é¸å–®ä¸»é </button>
            <button id="btn-sop" class="tab-btn gold" onclick="switchView('sop')">å®‰è£ SOP</button>
            <button id="btn-fault" class="tab-btn red" onclick="switchView('fault')">æ•…éšœæ’é™¤</button>
        </div>
    </div>

    <div class="content-container" id="scrollTarget">
        <section id="treeSection" class="view-section active">
            <div id="menuTree"></div>
        </section>

        <section id="sopSection" class="view-section">
            <h3>ğŸš€ å®‰è£èˆ‡åˆæ¬¡ä½¿ç”¨æŒ‡å—</h3>
            <div class="card"><span class="step-tag">1</span><b>é¡é ­å®‰è£å®‰å…¨å®ˆå‰‡</b><br>æ›´æ›é¡é ­å‰å¿…é ˆ<b>é—œé–‰ä¸»é›»æº</b>ã€‚ç§»é™¤å­”è“‹å¾Œæ’å…¥ä¸¦é †æ™‚é‡æ—‹è‡³ã€Œå–€åš“ã€è²ï¼Œå‹™å¿…é–ç·Šèºçµ²é˜²æ­¢æ‰è½ã€‚</div>
            <div class="card"><span class="step-tag">2</span><b>é›»æºèˆ‡äº®åº¦é™åˆ¶</b><br>ä½¿ç”¨ AC 100-120V æ™‚äº®åº¦æœƒé™è‡³ç´„ 1/3ã€‚å…¨äº®åº¦è¼¸å‡ºéœ€æ¥ <b>AC 200-240V</b> é›»æºã€‚</div>
            <div class="card"><span class="step-tag">3</span><b>åˆæ­¥ä½ç§»æ­¸ä½</b><br>é€²è¡Œæ‰€æœ‰èª¿æ•´å‰ï¼Œå»ºè­°å…ˆå°‡é¡é ­é¦¬é”æ­¸ä½ã€‚
                <span class="path-hint">è·¯å¾‘ï¼š[ä½ç½® (POSITION)] -> [ç§»ä½ (SHIFT)] -> åŸ·è¡Œ [è¿”å›åŸå§‹è¨­ç½®ä½ç½®]</span>
            </div>
            <div class="card"><span class="step-tag">4</span><b>å…¨æ©Ÿå‡ºå» åŒ–é‡ç½®</b><br>è‹¥è¨­å®šæ··äº‚ï¼Œå¯åŸ·è¡Œåˆå§‹åŒ–ã€‚
                <span class="path-hint">è·¯å¾‘ï¼š[æŠ•å½±æœºè®¾ç½® (PROJECTOR SETUP)] -> ä¸‹ä¸€é  [2/2] -> [åˆå§‹åŒ– (INITIALIZE)] -> [å‡ºå‚é‡ç½®]</span>
            </div>
            <div class="card"><span class="step-tag">5</span><b>åŸ·è¡Œé¡é ­æ ¡æ­£</b><br>æ›´æ›é¡é ­å¾Œå¿…åšå‹•ä½œï¼Œè®“é¦¬é”æ„Ÿæ‡‰æ¥µé™ä½ç½®ã€‚
                <span class="path-hint">è·¯å¾‘ï¼š[æŠ•å½±æœºè®¾ç½® (PROJECTOR SETUP)] -> [é•œå¤´ (LENS)] -> [é•œå¤´æ ¡æ­£ (LENS CALIBRATION)]</span>
            </div>
        </section>

        <section id="faultSection" class="view-section">
            <h3>âš ï¸ æ•…éšœæ’é™¤ (å…¨é¢æ•´åˆåŸå» æ‰‹å†Š)</h3>
            
            <div class="card fault-card"><span class="fault-q">Q: é›»æºç„¡æ³•é–‹å•Ÿæˆ–é™æ§å™¨ç„¡åæ‡‰ï¼Ÿ</span>
                1. <b>é›»æºæª¢æŸ¥</b>ï¼šæª¢æŸ¥é›»æºç·šæ˜¯å¦é¬†è„«ï¼Œä¸»é–‹é—œæ˜¯å¦è¨­ç‚º [I]ã€‚<br>
                2. <b>é™æ§å™¨</b>ï¼šæª¢æŸ¥é›»æ± ï¼Œä¸¦ç¢ºèª [REMOTE ID] æ˜¯å¦èˆ‡æ©Ÿèº«è¨­å®šä¸€è‡´ã€‚<br>
                3. <b>é¢æ¿é–å®š</b>ï¼šç¢ºèªä¸¦æœªå•Ÿç”¨æ§åˆ¶é¢æ¿é–å®šåŠŸèƒ½ã€‚
            </div>

            <div class="card fault-card"><span class="fault-q">Q: ç•«é¢äº®åº¦è®Šæš—ï¼Ÿ(æ·±åº¦æ’æŸ¥)</span>
                1. <b>AC é›»å£“</b>ï¼šç¢ºèªæ˜¯å¦æ¥åœ¨ 110Vï¼Ÿ110V ç’°å¢ƒäº®åº¦åƒ…å‰© 30% å·¦å³ã€‚<br>
                2. <b>æ“ä½œæ¨¡å¼</b>ï¼šç¢ºèªæ˜¯å¦è¨­ç‚º [ECO] æˆ– [QUIET] (æœƒé™ä½äº®åº¦ä»¥éœéŸ³)ã€‚<br>
                3. <b>æ†å®šæ¨¡å¼</b>ï¼š[CONSTANT MODE] è‹¥é–‹å•Ÿï¼Œäº®åº¦æœƒè‡ªå‹•é™åˆ¶ä»¥ç¶­æŒé•·æ•ˆä¸€è‡´æ€§ã€‚<br>
                4. <b>ç’°å¢ƒä¿è­·</b>ï¼šç’°å¢ƒæº«åº¦è‹¥é«˜æ–¼ 35Â°C (æˆ–é«˜æµ·æ‹” 25Â°C)ï¼Œå…‰æºæœƒå¼·åˆ¶é™ä½åŠŸç‡ã€‚
                <span class="path-hint">å°æ‡‰é¸å–®ï¼š[æŠ•å½±æœºè®¾ç½®] -> [æ“ä½œè®¾ç½®]</span>
            </div>

            <div class="card fault-card"><span class="fault-q">Q: è§£æåº¦ç•°å¸¸æˆ– 4K ç„¡æ³•æŠ“åˆ°ï¼Ÿ</span>
                1. <b>4K å•Ÿå‹•</b>ï¼šç¢ºèª [QUAD PIXEL DRIVE] æ˜¯å¦ç‚º [ON]ã€‚<br>
                2. <b>EDID è¡çª</b>ï¼šè‹¥é¡¯ç¤º Invalid Formatï¼Œè«‹æ‰‹å‹•èª¿æ•´ EDID æ¨¡å¼ã€‚<br>
                3. <b>è¨Šè™Ÿæ¸…å–®</b>ï¼šåœ¨ [SIGNAL LIST] ä¸­æª¢æŸ¥è¨Šè™Ÿæ˜¯å¦æ¨™ç¤ºç‚ºç´…è‰²ã€‚
                <span class="path-hint">è·¯å¾‘ï¼š[æ˜¾ç¤ºæ–¹å¼é€‰é¡¹] -> [HDMI EDID] -> [EDID MODE] -> [USER]</span>
            </div>

            <div class="card fault-card"><span class="fault-q">Q: æŒ‡ç¤ºç‡ˆç‹€æ…‹èˆ‡éŒ¯èª¤ä»£ç¢¼ (U/F/ç´…ç‡ˆ)ï¼Ÿ</span>
                1. <b>ç¶ ç‡ˆæ…¢é–ƒ</b>ï¼š[SHUTTER] å¿«é–€å·²å•Ÿå‹•ï¼ŒæŒ‰é™æ§å™¨å¿«é–€éµå›å¾©ã€‚<br>
                2. <b>U12 / U13</b>ï¼šæº«åº¦ç•°å¸¸ã€‚è«‹æ¸…ç†æ¿¾ç¶²ã€æª¢æŸ¥é€²æ’æ°£å­”æ˜¯å¦å µå¡ã€‚<br>
                3. <b>ç´…ç‡ˆå¿«é–ƒ (Fç³»ä»£ç¢¼)</b>ï¼šç¡¬é«”æˆ–é¢¨æ‰‡ææ¯€ï¼Œéœ€è¯çµ¡ç¶­ä¿®ã€‚<br>
                4. <b>ç´…ç‡ˆé•·äº®</b>ï¼šéƒ¨åˆ†é›·å°„å–®å…ƒæ•…éšœï¼ŒæŠ•å½±æ©Ÿä»å¯é‹ä½œä½†äº®åº¦é™ä½ã€‚
                <span class="path-hint">è·¯å¾‘ï¼š[ADVANCED èœå•] -> [çŠ¶æ€ (STATUS)] æŸ¥çœ‹è©³ç´°éŒ¯èª¤ç¢¼</span>
            </div>
        </section>
    </div>
</div>

<script>
    const ALIAS_MAP = {
        "æŠ•å½±æ–¹æ³•": ["æ­£æŠ•", "èƒŒæŠ•", "åŠæ›", "æ¡Œé¢", "æŠ•å½±æ–¹å¼", "æ–¹å‘", "é¡å°„", "å®‰è£", "projection"],
        "åˆå§‹åŒ–": ["é‚„åŸ", "å‡ºå» ", "é è¨­", "æ­¸é›¶", "reset", "factory", "initialize"],
        "å‡ ä½•çŸ«æ­£": ["è®Šå½¢", "æ‰­æ›²", "æ­ªäº†", "æ–œäº†", "æ¢¯å½¢", "ä¿®æ­£", "geometry", "keystone"],
        "å˜ç„¦ / èšç„¦": ["å¤§å°", "ç¸®æ”¾", "å°ç„¦", "zoom", "focus", "æ¨¡ç³Š"],
        "QUAD PIXEL DRIVE": ["4K", "è§£æåº¦", "ç•«è³ª", "ç•«ç´ ", "3840", "2160", "pixel"],
        "æ“ä½œè®¾ç½®": ["è®Šæš—", "ç¯€èƒ½", "å®‰éœ", "äº®åº¦", "æ†å®š", "æ†å®šæ¨¡å¼", "æ“ä½œæ¨¡å¼", "æº«åº¦", "ä¿è­·"]
    };

    const menuData = [
        { cn: "1. å›¾åƒ (PICTURE)", en: "PICTURE", children: [
            { cn: "å›¾åƒæ¨¡å¼", en: "PICTURE MODE", options: ["æ ‡å‡†", "ç”µå½±", "è‡ªç„¶", "å›¾å½¢", "åŠ¨æ€"] },
            { cn: "å¯¹æ¯”åº¦ / äº®åº¦", en: "CONTRAST / BRIGHTNESS", options: ["å¯¹æ¯”åº¦", "äº®åº¦", "å½©è‰²", "è‰²åº¦ (TINT)", "æ¸…æ™°åº¦ (SHARPNESS)", "è‰²æ¸©è®¾å®š"] },
            { cn: "ç™½å¹³è¡¡", en: "WHITE BALANCE", options: ["çº¢è‰²å¢ç›Š", "ç»¿è‰²å¢ç›Š", "è“è‰²å¢ç›Š", "çº¢è‰²æˆªæ­¢", "è“è‰²æˆªæ­¢"] },
            { cn: "åŠ¨æ€å¯¹æ¯”åº¦", en: "DYNAMIC CONTRAST", options: ["å…³", "1 / 2 / 3", "é–‹ (LIGHTS OUT)"] },
            { cn: "SYSTEM DAYLIGHT VIEW", en: "ç³»ç»Ÿæ˜¼å…‰è§†å›¾", options: ["è°ƒæ•´ç¯å¢ƒå…‰è¡¥å¿"] }
        ]},
        { cn: "2. ä½ç½® (POSITION)", en: "POSITION", children: [
            { cn: "ç§»ä½", en: "SHIFT", options: ["å‚ç›´ç§»ä½", "æ°´å¹³ç§»ä½", "è¿”å›åŸå§‹è¨­ç½®ä½ç½®"] },
            { cn: "å®½é«˜æ¯”", en: "ASPECT", options: ["16:10", "16:9", "4:3", "THROUGH (é»å°é»)", "AUTO"] },
            { cn: "å˜ç„¦ / èšç„¦", en: "ZOOM / FOCUS", options: ["å˜ç„¦", "èšç„¦"] },
            { cn: "å‡ ä½•çŸ«æ­£", en: "GEOMETRY", children: [
                { cn: "æ¢¯å½¢çŸ«æ­£", en: "KEYSTONE", options: ["å‚ç›´æ¢¯å½¢", "æ°´å¹³æ¢¯å½¢", "å¹³è¡¡ä¿®æ­£"] },
                { cn: "è§’/æ•å½¢", en: "CORNER / PINCUSHION", options: ["å·¦ä¸Š/å³ä¸Š/å·¦ä¸‹/å³ä¸‹", "ç·šæ€§", "æ•å½¢"] },
                { cn: "æ›²é¢çŸ«æ­£", en: "CURVED CORRECTION", options: ["å‚ç›´å¼§å½¢", "æ°´å¹³å¼§å½¢"] },
                { cn: "è‡ªç”±ç½‘æ ¼", en: "FREE GRID", options: ["2x2 ~ 16x16 é»ä½ç´°èª¿"] }
            ]}
        ]},
        { cn: "3. è¿›é˜¶èœå• (ADVANCED MENU)", en: "ADVANCED MENU", children: [
            { cn: "QUAD PIXEL DRIVE", en: "4K é©±åŠ¨", options: ["å¼€ (3840x2400)", "å…³ (1920x1200)"] },
            { cn: "è¾¹ç¼˜æ··åˆ", en: "EDGE BLENDING", options: ["æ ‡è®° (Marker)", "å®½åº¦èª¿æ•´", "é»‘éšè£œå„Ÿ"] },
            { cn: "ç°åº¦å¹³æ»‘å™¨", en: "GRAYSCALE SMOOTHER", options: ["å…³", "å¼€"] },
            { cn: "DIGITAL CINEMA REALITY", en: "æ•°å­—ç”µå½±çœŸå½©", options: ["é‡å°äº¤éŒ¯å¼å½±åƒå¢å¼·ç•«è³ª"] },
            { cn: "çŠ¶æ€", en: "STATUS", options: ["è©³ç´°æ©Ÿèº«è¨ºæ–·è³‡è¨Š", "é‹è¡Œæ™‚é–“", "åºåˆ—è™Ÿ"] }
        ]},
        { cn: "4. æ˜¾ç¤ºè¯­ç§ (LANGUAGE)", en: "LANGUAGE", options: ["ä¸­æ–‡", "ENGLISH", "æ—¥æœ¬èª", "í•œêµ­ì–´"] },
        { cn: "5. æ˜¾ç¤ºæ–¹å¼é€‰é¡¹ (DISPLAY OPTION)", en: "DISPLAY OPTION", children: [
            { cn: "HDMI EDID è®¾ç½®", en: "HDMI EDID", options: ["EDID MODE (DEFAULT/USER)", "EDID SELECT (4K/60p/2K)"] },
            { cn: "è‰²å½©åŒ¹é…", en: "COLOR MATCHING", options: ["3-Colors / 7-Colors"] },
            { cn: "å±å¹•è®¾å®š", en: "SCREEN SETTING", options: ["å±å¹•æ ¼å¼ (16:10)", "å±å¹•ä½ç½®", "å±å¹•æ ‡è¯†"] },
            { cn: "æ˜¾ç¤ºèœå•", en: "DISPLAY MENU", options: ["OSDä½ç½®", "OSD æ—‹è½¬"] }
        ]},
        { cn: "6. æŠ•å½±æœºè®¾ç½® (PROJECTOR SETUP)", en: "PROJECTOR SETUP", children: [
            { cn: "æŠ•å½±æ–¹æ³•", en: "PROJECTION METHOD", options: ["æ­£æŠ•/åŠæ› (FRONT/CEILING)", "æ­£æŠ•/æ¡Œé¢ (FRONT/DESK)", "èƒŒæŠ•/åŠæ› (REAR/CEILING)", "èƒŒæŠ•/æ¡Œé¢ (REAR/DESK)"] },
            { cn: "é•œå¤´", en: "LENS", children: [
                { cn: "é•œå¤´è®°å½•", en: "LENS MEMORY", options: ["å„²å­˜/èª¿ç”¨ä½ç½®"] },
                { cn: "é•œå¤´æ ¡æ­£", en: "LENS CALIBRATION", options: ["æ‰§è¡Œæ ¡æ­£ (é©¬é”é‡ç½®)"] }
            ]},
            { cn: "æ“ä½œè®¾ç½®", en: "OPERATION SETTING", options: ["æ“ä½œæ¨¡å¼ (NORMAL/ECO/QUIET)", "æ†å®šæ¨¡å¼ (CONSTANT MODE)", "å…‰æºè¼¸å‡º % (LIGHT OUTPUT)"] },
            { cn: "åˆå§‹åŒ–", en: "INITIALIZE", children: [
                { cn: "å‡ºå‚é‡ç½®", en: "FACTORY RESET", options: ["ç”¨æˆ·è®¾ç½®", "ä»…é™ç™»å½•ä¿¡å·", "ä»…é™ç½‘ç»œ"] }
            ]}
        ]},
        { cn: "7. æµ‹è¯•æ¨¡å¼ (TEST PATTERN)", en: "TEST PATTERN", options: ["ç½‘æ ¼", "å…¨ç™½", "å½©æ¢", "RGB"] },
        { cn: "8. ç™»å½•ä¿¡å·ä¸€è§ˆ (SIGNAL LIST)", en: "SIGNAL LIST", options: ["æª¢æŸ¥è¼¸å…¥è¨Šè™Ÿè§£æåº¦èˆ‡é »ç‡"] }
    ];

    function handleTreeTabClick() {
        if (!document.getElementById('treeSection').classList.contains('active')) {
            switchView('tree');
        } else {
            const nodes = document.querySelectorAll('.node');
            const isAnyExpanded = Array.from(nodes).some(n => n.classList.contains('expanded'));
            handleMasterToggle(!isAnyExpanded);
        }
    }

    function switchView(view) {
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(view + 'Section').classList.add('active');
        document.getElementById('btn-' + view).classList.add('active');
        document.getElementById('scrollTarget').scrollTop = 0;
    }

    function globalSearch() {
        const rawInput = document.getElementById('searchInput').value.toLowerCase().trim();
        const nodes = document.querySelectorAll('.node');
        const labels = document.querySelectorAll('.label');
        const cards = document.querySelectorAll('.card');
        const clearBtn = document.getElementById('clearSearch');

        clearBtn.classList.toggle('active', rawInput !== "");

        if (!rawInput) {
            nodes.forEach(n => { n.classList.remove('hidden', 'expanded'); n.querySelector('.label').classList.remove('highlight'); });
            cards.forEach(c => c.classList.remove('hidden'));
            return;
        }

        let searchPool = [rawInput];
        for (let key in ALIAS_MAP) {
            if (ALIAS_MAP[key].some(a => a.includes(rawInput)) || key.includes(rawInput)) searchPool.push(key.toLowerCase());
        }

        let treeMatchCount = 0;
        nodes.forEach(n => n.classList.add('hidden'));

        labels.forEach(l => {
            const text = l.innerText.toLowerCase();
            const isHit = searchPool.some(k => text.includes(k));
            if (isHit) {
                treeMatchCount++;
                l.classList.add('highlight');
                let currNode = l.parentElement; 
                while (currNode && currNode.classList.contains('node')) {
                    currNode.classList.remove('hidden');
                    currNode.classList.add('expanded');
                    let parentContent = currNode.parentElement;
                    currNode = (parentContent && parentContent.classList.contains('children')) ? parentContent.parentElement : null;
                }
            } else { l.classList.remove('highlight'); }
        });

        cards.forEach(c => {
            const content = c.innerText.toLowerCase();
            const isHit = searchPool.some(k => content.includes(k));
            c.classList.toggle('hidden', !isHit);
        });

        if (treeMatchCount > 0 && !document.getElementById('treeSection').classList.contains('active')) switchView('tree');
    }

    function clearInput() { document.getElementById('searchInput').value = ""; globalSearch(); }
    function handleMasterToggle(expand) { document.querySelectorAll('.node').forEach(n => expand ? n.classList.add('expanded') : n.classList.remove('expanded')); }

    function draw(data, parent, level = 0) {
        data.forEach(item => {
            const node = document.createElement('div');
            node.className = `node level-${level} ${item.children ? '' : 'leaf'}`;
            const label = document.createElement('div');
            label.className = 'label';
            label.innerHTML = `<span class="cn-text">${item.cn}</span><span class="en-text">(${item.en})</span>`;
            label.onclick = (e) => { e.stopPropagation(); node.classList.toggle('expanded'); };
            node.appendChild(label);
            if (item.options) {
                const optBox = document.createElement('div');
                optBox.className = 'options-box';
                item.options.forEach(opt => {
                    const d = document.createElement('div');
                    d.className = 'option-item';
                    d.innerText = opt;
                    optBox.appendChild(d);
                });
                node.appendChild(optBox);
            }
            if (item.children) {
                const childWrap = document.createElement('div');
                childWrap.className = 'children';
                draw(item.children, childWrap, level + 1);
                node.appendChild(childWrap);
            }
            parent.appendChild(node);
        });
    }
    draw(menuData, document.getElementById('menuTree'));
</script>
</body>
</html>
